---
import Layout from "../../../../../layouts/Layout.astro";
import GpaLayout from "../../../../../components/GpaLayout";
import BMICalculator from "../../../../../components/BmiCalculator";

export async function getStaticPaths() {
  const units = {
    metric: {
      weight: { min: 1, max: 250, step: 1 },
      height: { min: 55, max: 300, step: 1 },
    },
    imperial: {
      weight: { min: 1, max: 330, step: 1 },
      height: { min: 21, max: 110, step: 1 },
    },
  };

  const paths = [];

  Object.entries(units).forEach(([unit, ranges]) => {
    for (
      let w = ranges.weight.min;
      w <= ranges.weight.max;
      w += ranges.weight.step
    ) {
      for (
        let h = ranges.height.min;
        h <= ranges.height.max;
        h += ranges.height.step
      ) {
        paths.push({
          params: {
            unit,
            weight: w.toString(),
            height: h.toString(),
          },
          props: {
            unit,
            weight: w,
            height: h,
          },
        });
      }
    }
  });

  return paths;
}

const { unit, weight, height } = Astro.props;

// Related calculations for linking
const generateRelatedLinks = (unit, weight, height) => {
  const variations = [];
  const weightDiff = unit === "metric" ? 5 : 11;
  const heightDiff = unit === "metric" ? 5 : 2;

  // Add weight variations
  variations.push({
    weight: Number(weight) + weightDiff,
    height: Number(height),
    label: `Higher weight (${Number(weight) + weightDiff}${unit === "metric" ? "kg" : "lbs"})`,
  });
  variations.push({
    weight: Number(weight) - weightDiff,
    height: Number(height),
    label: `Lower weight (${Number(weight) - weightDiff}${unit === "metric" ? "kg" : "lbs"})`,
  });

  // Add height variations
  variations.push({
    weight: Number(weight),
    height: Number(height) + heightDiff,
    label: `Taller height (${Number(height) + heightDiff}${unit === "metric" ? "cm" : "in"})`,
  });
  variations.push({
    weight: Number(weight),
    height: Number(height) - heightDiff,
    label: `Shorter height (${Number(height) - heightDiff}${unit === "metric" ? "cm" : "in"})`,
  });

  return variations.filter(
    (v) =>
      v.weight > 0 &&
      v.height > 0 &&
      v.weight <= (unit === "metric" ? 150 : 330) &&
      v.height <= (unit === "metric" ? 200 : 79)
  );
};

const relatedLinks = generateRelatedLinks(unit, weight, height);

function calculateBMI(weight, height, unit) {
  if (unit === "metric") {
    return (weight / Math.pow(height / 100, 2)).toFixed(1);
  }
  return ((703 * weight) / Math.pow(height, 2)).toFixed(1);
}

function getBMICategory(bmi) {
  if (bmi < 18.5) return "Underweight";
  if (bmi < 24.9) return "Normal weight";
  if (bmi < 29.9) return "Overweight";
  return "Obese";
}

function getBMIAdvice(category) {
  const advice = {
    Underweight:
      "Consider consulting with a healthcare provider about healthy ways to gain weight.",
    "Normal weight":
      "Maintain your healthy weight through balanced diet and regular exercise.",
    Overweight:
      "Small lifestyle changes can help bring your BMI into a healthier range.",
    Obese:
      "Speak with a healthcare provider about strategies for reaching a healthier weight.",
  };
  return advice[category];
}

const bmiValue = calculateBMI(weight, height, unit);
const bmiCategory = getBMICategory(bmiValue);
const advice = getBMIAdvice(bmiCategory);

const unitLabel =
  unit === "metric"
    ? { weight: "kg", height: "cm" }
    : { weight: "lbs", height: "inches" };

const title = `BMI Calculator for ${weight}${unitLabel.weight} and ${height}${unitLabel.height}`;
const description = `Calculate BMI for ${weight}${unitLabel.weight} weight and ${height}${unitLabel.height} height. BMI value is ${bmiValue} (${bmiCategory}).`;
const keywords = `bmi calculator ${weight}${unitLabel.weight}, ${height}${unitLabel.height} bmi, calculate bmi ${weight} ${height}, body mass index calculator`;

const calculatorSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  name: title,
  description: description,
  mainEntity: {
    "@type": "Question",
    name: `What is the BMI for ${weight}${unitLabel.weight} and ${height}${unitLabel.height}?`,
    acceptedAnswer: {
      "@type": "Answer",
      text: `The BMI for a person weighing ${weight}${unitLabel.weight} and ${height}${unitLabel.height} tall is ${bmiValue}, which is classified as ${bmiCategory}.`,
    },
  },
};
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  currentUrl={Astro.url.pathname}  
  additionalSchema={calculatorSchema}
>
  <GpaLayout client:load {title} {description} {keywords}>
    <div class="space-y-12">
      {/* Main Calculator Section */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-2xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <div class="text-center mb-8">
          <div class="text-4xl font-display font-bold text-accent-primary mb-2">
            {bmiValue}
          </div>
          <div
            class="text-xl text-content-light-dimmed dark:text-content-dark-dimmed"
          >
            Your BMI Category: <span class="font-semibold">{bmiCategory}</span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg text-center"
          >
            <div
              class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed mb-1"
            >
              Weight
            </div>
            <div class="text-xl font-semibold">{weight}{unitLabel.weight}</div>
          </div>
          <div
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg text-center"
          >
            <div
              class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed mb-1"
            >
              Height
            </div>
            <div class="text-xl font-semibold">{height}{unitLabel.height}</div>
          </div>
        </div>

        <BMICalculator
          client:load
          defaultUnit={unit}
          defaultWeight={weight}
          defaultHeight={height}
          autoCalculate={true}
        />
      </div>

      {/* Related Calculations */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Related BMI Calculations
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {
            relatedLinks.map((link) => (
              <a
                href={`/calculators/bmi/${unit}/${link.weight}/${link.height}`}
                class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
              >
                <div class="font-medium">{link.label}</div>
                <div class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed">
                  Calculate BMI
                </div>
              </a>
            ))
          }
        </div>
      </div>

      {/* Gender-Specific Links */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Gender-Specific BMI Information
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <a
            href="/calculators/bmi/women"
            class="p-6 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
          >
            <h3 class="text-xl font-display font-bold mb-2">
              Women's BMI Calculator
            </h3>
            <p class="text-content-light-dimmed dark:text-content-dark-dimmed">
              Get BMI calculations and health recommendations specific to women.
            </p>
          </a>
          <a
            href="/calculators/bmi/men"
            class="p-6 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
          >
            <h3 class="text-xl font-display font-bold mb-2">
              Men's BMI Calculator
            </h3>
            <p class="text-content-light-dimmed dark:text-content-dark-dimmed">
              Get BMI calculations and health recommendations specific to men.
            </p>
          </a>
        </div>
      </div>

      {/* Health Recommendations */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Health Recommendations
        </h2>
        <div class="space-y-6">
          <div
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg"
          >
            <h3 class="font-display font-semibold text-lg mb-2">
              Your BMI Results
            </h3>
            <p class="text-content-light-dimmed dark:text-content-dark-dimmed">
              With a BMI of {bmiValue}, you are classified as {
                bmiCategory.toLowerCase()
              }. {advice}
            </p>
          </div>

          <div
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg"
          >
            <h3 class="font-display font-semibold text-lg mb-2">Next Steps</h3>
            <div
              class="space-y-2 text-content-light-dimmed dark:text-content-dark-dimmed"
            >
              <p>• Track your BMI over time to monitor changes</p>
              <p>• Consider consulting with healthcare professionals</p>
              <p>• Combine BMI with other health measurements</p>
              <p>• Check age-specific BMI recommendations</p>
            </div>
          </div>
        </div>
      </div>

      {/* Age-Specific Links */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">BMI by Age Group</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {
            [25, 35, 45, 55, 65].map((age) => (
              <a
                href={`/calculators/bmi/age/${age}`}
                class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
              >
                <div class="font-medium">Age {age} BMI Calculator</div>
                <div class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed">
                  Get age-specific BMI guidance
                </div>
              </a>
            ))
          }
        </div>
      </div>

      {/* Unit Conversion Link */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">Switch Units</h2>
        <a
          href={`/calculators/bmi/${unit === "metric" ? "imperial" : "metric"}/${
            unit === "metric"
              ? (weight * 2.20462).toFixed(0)
              : (weight / 2.20462).toFixed(0)
          }/${
            unit === "metric"
              ? (height / 2.54).toFixed(0)
              : (height * 2.54).toFixed(0)
          }`}
          class="block p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
        >
          <div class="font-medium">
            Switch to {unit === "metric" ? "Imperial" : "Metric"} Units
          </div>
          <div
            class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed"
          >
            View BMI calculation in {
              unit === "metric"
                ? "pounds and inches"
                : "kilograms and centimeters"
            }
          </div>
        </a>
      </div>

      {/* Common BMI Values */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Common BMI Calculations
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {/* Generate common BMI value links */}
          {
            [
              { label: "Underweight Example", bmi: 17.5 },
              { label: "Normal Weight Example", bmi: 22.0 },
              { label: "Overweight Example", bmi: 27.5 },
            ].map((example) => {
              const exampleHeight = unit === "metric" ? 170 : 67;
              const exampleWeight =
                unit === "metric"
                  ? (example.bmi * Math.pow(170 / 100, 2)).toFixed(0)
                  : ((example.bmi * Math.pow(67, 2)) / 703).toFixed(0);

              return (
                <a
                  href={`/calculators/bmi/${unit}/${exampleWeight}/${exampleHeight}`}
                  class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
                >
                  <div class="font-medium">{example.label}</div>
                  <div class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed">
                    BMI: {example.bmi} ({exampleWeight}
                    {unitLabel.weight})
                  </div>
                </a>
              );
            })
          }
        </div>
      </div>

      {/* BMI Range Categories */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Understanding BMI Ranges
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {
            [
              {
                category: "Normal Weight Range",
                range: "18.5 - 24.9",
                description: "A healthy weight range based on your height.",
              },
              {
                category: "Health Implications",
                description:
                  "BMI is one of several factors in assessing overall health.",
              },
              {
                category: "Weight Changes",
                description:
                  "Track BMI changes over time for better health monitoring.",
              },
              {
                category: "Additional Factors",
                description:
                  "Consider age, gender, muscle mass, and body composition.",
              },
            ].map((info) => (
              <div class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg">
                <h3 class="font-display font-semibold text-lg mb-2">
                  {info.category}
                </h3>
                {info.range && (
                  <div class="text-accent-primary font-medium mb-1">
                    Range: {info.range}
                  </div>
                )}
                <p class="text-content-light-dimmed dark:text-content-dark-dimmed">
                  {info.description}
                </p>
              </div>
            ))
          }
        </div>
      </div>

      {/* Additional Resources */}
      <div
        class="bg-surface-light dark:bg-surface-dark-hover rounded-xl p-6 border border-gray-200/10 dark:border-gray-800/10"
      >
        <h2 class="text-2xl font-display font-bold mb-6">
          Additional Resources
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <a
            href="/calculators/bmi"
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
          >
            <div class="font-medium">Main BMI Calculator</div>
            <div
              class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed"
            >
              Try different calculations
            </div>
          </a>
          <a
            href={`/calculators/bmi/women`}
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
          >
            <div class="font-medium">Women's Health</div>
            <div
              class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed"
            >
              Female-specific BMI guidance
            </div>
          </a>
          <a
            href={`/calculators/bmi/men`}
            class="p-4 bg-surface-light-hover dark:bg-surface-dark rounded-lg hover:bg-accent-primary/10 transition-colors"
          >
            <div class="font-medium">Men's Health</div>
            <div
              class="text-sm text-content-light-dimmed dark:text-content-dark-dimmed"
            >
              Male-specific BMI guidance
            </div>
          </a>
        </div>
      </div>
    </div>
  </GpaLayout>
</Layout>
